<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reggaeton: A Comprehensive Visualization</title>
  <link rel="stylesheet" href="style.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/sigma.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.parsers.gexf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.plugins.dragNodes.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.layout.fruchtermanReingold.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.layout.forceAtlas2.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>Reggaeton Network Visualization</h1>
    </header>

    <div id="graph-container" style="height: 90vh;"></div>
    <div id="node-info" style="position: absolute; top: 10px; right: 10px; background: #fff; border: 1px solid #ccc; padding: 10px; display: none;"></div>
    <div style="position: absolute; bottom: 20px; left: 20px; background: white; padding: 10px; border: 1px solid #ccc;">
      <label for="layout-select">Layout:</label>
      <select id="layout-select">
        <option value="fr">Fruchterman-Reingold</option>
        <option value="fa2">ForceAtlas2</option>
        <option value="rotation">Rotation</option>
      </select>
      <button id="toggle-layout">Stop Animation</button>
      <span id="layout-name" style="margin-left: 10px; font-weight: bold;"></span>
    </div>
  </div>

  <div class="button-group">
    <a href="welcome.html">Take me to Homepage</a>
  </div>

  <script>
    sigma.parsers.gexf(
      'Reggaeton.gexf',
      {
        container: 'graph-container',
        settings: {
          defaultNodeColor: '#3388AA',
          defaultEdgeColor: '#ccc',
          edgeColor: 'default',
          minNodeSize: 2,
          maxNodeSize: 15,
          minEdgeSize: 0.5,
          maxEdgeSize: 2,
          labelThreshold: 0,
          labelSize: 'proportional',
          labelSizeRatio: 1,
          drawLabels: true,
          drawEdgeLabels: false,
          zoomingRatio: 1.5,
          mouseZoomDuration: 20,
          doubleClickEnabled: false,
          mouseEnabled: true,
          touchEnabled: true,
          hideEdgesOnMove: true,
          hideLabelsOnMove: true,
          canvasEdges: true,
          autoRescale: true,
          batchEdgesDrawing: true,
          drawNodes: true
        }
      },
      function(s) {
        sigma.plugins.dragNodes(s, s.renderers[0]);

        let isRunning = true;
        let layoutIndex = 0;
        const layouts = ['fr', 'fa2', 'rotation'];

        function updateLayoutLabel(name) {
          document.getElementById('layout-name').textContent = name;
        }

        function startFR() {
          sigma.layouts.fruchtermanReingold.configure(s, {
            iterations: 200,
            easing: 'quadraticInOut',
            duration: 5000,
            gravity: 1,
            scalingRatio: 5,
            strongGravityMode: false
          });
          sigma.layouts.fruchtermanReingold.start(s);
          updateLayoutLabel('Fruchterman-Reingold');
        }

        function startFA2() {
          s.startForceAtlas2({
            linLogMode: false,
            outboundAttractionDistribution: false,
            adjustSizes: true,
            edgeWeightInfluence: 1,
            scalingRatio: 10,
            strongGravityMode: false,
            gravity: 1,
            slowDown: 1
          });
          updateLayoutLabel('ForceAtlas2');
        }

        function stopFA2() {
          if (s.isForceAtlas2Running && s.isForceAtlas2Running()) s.stopForceAtlas2();
        }

        function rotateLayout() {
          s.graph.nodes().forEach(function(n) {
            const angle = Math.PI / 180;
            const cos = Math.cos(angle);
            const sin = Math.sin(angle);
            const x = n.x;
            const y = n.y;
            n.x = x * cos - y * sin;
            n.y = x * sin + y * cos;
          });
          s.refresh();
          updateLayoutLabel('Rotation');
        }

        function cycleLayouts() {
          const layout = layouts[layoutIndex];
          layoutIndex = (layoutIndex + 1) % layouts.length;

          stopFA2();
          sigma.layouts.fruchtermanReingold.stop();

          if (layout === 'fr') startFR();
          else if (layout === 'fa2') startFA2();
          else if (layout === 'rotation') rotateLayout();

          document.getElementById('layout-select').value = layout;
        }

        startFR();

        const interval = setInterval(() => {
          if (isRunning) cycleLayouts();
        }, 6000);

        document.getElementById('toggle-layout').addEventListener('click', function() {
          isRunning = !isRunning;
          this.textContent = isRunning ? 'Stop Animation' : 'Start Animation';

          if (!isRunning) {
            stopFA2();
            sigma.layouts.fruchtermanReingold.stop();
          } else {
            cycleLayouts();
          }
        });

        document.getElementById('layout-select').addEventListener('change', function(e) {
          const selected = e.target.value;
          layoutIndex = layouts.indexOf(selected);
          cycleLayouts();
        });

        s.bind('clickNode', function(e) {
          var data = s.graph.nodes(e.data.node.id);
          var label = data.label || data.id;
          document.getElementById('node-info').innerHTML = '<strong>' + label + '</strong>';
          document.getElementById('node-info').style.display = 'block';
        });

        s.refresh();
      }
    );
  </script>
</body>
</html>
