<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reggaeton: A Comprehensive Visualization</title>
  <link rel="stylesheet" href="style.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/sigma.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.parsers.gexf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.plugins.dragNodes.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.layout.fruchtermanReingold.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>Reggaeton Network Visualization</h1>
    </header>

    <div id="graph-container" style="height: 90vh;"></div>
    <div id="node-info" style="position: absolute; top: 10px; right: 10px; background: #fff; border: 1px solid #ccc; padding: 10px; display: none;"></div>
    <div style="position: absolute; bottom: 20px; left: 20px; background: white; padding: 10px; border: 1px solid #ccc;">
      <label><input type="checkbox" id="toggle-edge-labels"> Show Edge Labels</label>
      <button id="toggle-layout" style="margin-left: 10px;">Toggle Animation</button>
    </div>
  </div>

  <div class="button-group">
    <a href="welcome.html">Take me to Homepage</a>
  </div>

  <script>
    sigma.parsers.gexf(
      'Reggaeton.gexf',
      {
        container: 'graph-container',
        settings: {
          defaultNodeColor: '#3388AA',
          defaultEdgeColor: '#ccc',
          edgeColor: 'default',
          minNodeSize: 2,
          maxNodeSize: 15,
          minEdgeSize: 0.5,
          maxEdgeSize: 2,
          labelThreshold: 0,
          labelSize: 'proportional',
          labelSizeRatio: 1,
          drawLabels: true,
          drawEdgeLabels: true,
          zoomingRatio: 1.5,
          mouseZoomDuration: 20,
          doubleClickEnabled: false,
          mouseEnabled: true,
          touchEnabled: true,
          hideEdgesOnMove: true,
          hideLabelsOnMove: true,
          canvasEdges: true,
          autoRescale: true,
          batchEdgesDrawing: true,
          drawNodes: true
        }
      },
      function(s) {
        sigma.plugins.dragNodes(s, s.renderers[0]);

        // Connect drag behavior to connected nodes
        const dragListener = s.graph.nodes().reduce((map, node) => {
          map[node.id] = [];
          return map;
        }, {});

        s.graph.edges().forEach(edge => {
          dragListener[edge.source].push(edge.target);
          dragListener[edge.target].push(edge.source);
        });

        s.bind('drag', function(event) {
          const node = event.data.node;
          const dx = event.data.captor.clientX - (node['lastX'] || 0);
          const dy = event.data.captor.clientY - (node['lastY'] || 0);

          dragListener[node.id]?.forEach(neighborId => {
            const neighbor = s.graph.nodes(neighborId);
            if (neighbor && (typeof neighbor['x'] === 'number' && typeof neighbor['y'] === 'number')) {
              neighbor.x += dx * 0.01;
              neighbor.y += dy * 0.01;
            }
          });

          node['lastX'] = event.data.captor.clientX;
          node['lastY'] = event.data.captor.clientY;

          s.refresh();
        });

        // Edge label fix
        s.graph.edges().forEach(function(edge) {
          const edgeLabel = edge.label || edge.attributes?.label || edge.attributes?.Label || edge.attributes?.Collaborations || edge.id;
          edge.label = edgeLabel;
        });

        document.getElementById('toggle-edge-labels').addEventListener('change', function(e) {
          s.settings('drawEdgeLabels', e.target.checked);
          s.refresh();
        });

        document.getElementById('toggle-layout').addEventListener('click', function() {
          if (s.isForceAtlas2Running && s.isForceAtlas2Running()) {
            s.stopForceAtlas2();
            this.textContent = 'Start Animation';
          } else {
            s.startForceAtlas2();
            this.textContent = 'Stop Animation';
          }
        });

        s.bind('clickNode', function(e) {
          const data = e.data.node;
          const label = data.label || data.id;
          document.getElementById('node-info').innerHTML = '<strong>' + label + '</strong>';
          document.getElementById('node-info').style.display = 'block';
        });

        s.refresh();
      }
    );
  </script>
</body>
</html>


